<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TurboSanta - Free Secret Santa Generator, No Login Required</title>
    <meta name="description" content="Create a Secret Santa gift exchange in seconds. No login, no sign up, no email required. Just add names, share the link, and everyone picks their match privately.">
    <meta name="keywords" content="secret santa, gift exchange, name generator, christmas, holiday, no login, free">
    <meta property="og:title" content="TurboSanta - Free Secret Santa Generator">
    <meta property="og:description" content="Create a Secret Santa gift exchange in seconds. No login required. Just add names and share the link.">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="TurboSanta - Free Secret Santa Generator">
    <meta name="twitter:description" content="Create a Secret Santa gift exchange in seconds. No login required.">
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #0f172a;
        color: #f1f5f9;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 3rem 1rem;
      }

      ::selection {
        background: #ef4444;
        color: white;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
      }

      header h1 {
        font-size: 2.25rem;
        font-weight: 800;
        color: white;
      }

      header h1 span {
        color: #ef4444;
      }

      header p {
        color: #94a3b8;
        margin-top: 0.5rem;
      }

      main {
        width: 100%;
        max-width: 28rem;
        background: rgba(30, 41, 59, 0.5);
        border: 1px solid #334155;
        border-radius: 1rem;
        padding: 1.5rem;
        backdrop-filter: blur(12px);
      }

      .space-y > * + * {
        margin-top: 1.5rem;
      }

      .space-y-sm > * + * {
        margin-top: 0.5rem;
      }

      h2 {
        font-size: 1.25rem;
        font-weight: 600;
        color: white;
      }

      .form-row {
        display: flex;
        gap: 0.5rem;
      }

      input[type="text"], textarea, select {
        flex: 1;
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid #475569;
        color: white;
        border-radius: 0.5rem;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        outline: none;
        transition: border-color 0.2s, box-shadow 0.2s;
      }

      input[type="text"]:focus, textarea:focus, select:focus {
        border-color: #ef4444;
        box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
      }

      input::placeholder, textarea::placeholder {
        color: #475569;
      }

      button {
        cursor: pointer;
        border: none;
        font-size: 1rem;
        transition: background-color 0.2s, opacity 0.2s;
      }

      .btn-primary {
        background: #ef4444;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 500;
      }

      .btn-primary:hover {
        background: #dc2626;
      }

      .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .btn-green {
        background: #059669;
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        font-weight: 700;
        font-size: 1.125rem;
        width: 100%;
      }

      .btn-green:hover {
        background: #047857;
      }

      .btn-green:disabled {
        background: #334155;
        color: #64748b;
        cursor: not-allowed;
      }

      .btn-secondary {
        background: #334155;
        color: white;
        padding: 0.5rem;
        border-radius: 0.5rem;
      }

      .btn-secondary:hover {
        background: #475569;
      }

      .link-btn {
        background: none;
        color: #94a3b8;
        text-decoration: underline;
        padding: 0;
        font-size: 0.875rem;
      }

      .link-btn:hover {
        color: #cbd5e1;
      }

      .link-btn-red {
        color: #f87171;
      }

      .link-btn-red:hover {
        color: #fca5a5;
      }

      .list-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
      }

      .list-header span {
        font-size: 0.875rem;
        color: #94a3b8;
        font-weight: 500;
      }

      .name-list {
        background: rgba(15, 23, 42, 0.5);
        border: 1px solid rgba(51, 65, 85, 0.5);
        border-radius: 0.5rem;
        max-height: 12rem;
        overflow-y: auto;
        list-style: none;
      }

      .name-list li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem;
        border-bottom: 1px solid rgba(51, 65, 85, 0.5);
      }

      .name-list li:last-child {
        border-bottom: none;
      }

      .name-list li:hover {
        background: rgba(51, 65, 85, 0.3);
      }

      .name-list .empty {
        text-align: center;
        color: #64748b;
        font-style: italic;
        font-size: 0.875rem;
        padding: 1rem;
      }

      .remove-btn {
        background: none;
        color: #64748b;
        font-size: 1.25rem;
        padding: 0 0.25rem;
        opacity: 0;
        transition: opacity 0.2s, color 0.2s;
      }

      .name-list li:hover .remove-btn {
        opacity: 1;
      }

      .remove-btn:hover {
        color: #f87171;
      }

      .success-box {
        background: #0f172a;
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 0.75rem;
        padding: 1rem;
      }

      .success-box .header {
        display: flex;
        gap: 0.75rem;
        align-items: flex-start;
        margin-bottom: 0.75rem;
      }

      .success-box .icon {
        background: rgba(16, 185, 129, 0.1);
        color: #34d399;
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .success-box h3 {
        color: #34d399;
        font-weight: 600;
      }

      .success-box p {
        color: #94a3b8;
        font-size: 0.875rem;
      }

      .copy-row {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
      }

      .copy-row input {
        font-family: monospace;
        font-size: 0.875rem;
        color: #cbd5e1;
      }

      .feedback {
        color: #34d399;
        font-size: 0.875rem;
        text-align: center;
        display: none;
      }

      .feedback.show {
        display: block;
      }

      .view-header {
        text-align: center;
      }

      .avatar {
        width: 4rem;
        height: 4rem;
        background: rgba(51, 65, 85, 0.3);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        color: #f87171;
        box-shadow: 0 0 0 4px #1e293b;
      }

      .view-header h2 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
      }

      .view-header p {
        color: #94a3b8;
        font-size: 0.875rem;
      }

      select {
        width: 100%;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        font-size: 1.125rem;
        text-align: center;
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2394a3b8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 1rem center;
      }

      .lock-notice {
        background: rgba(245, 158, 11, 0.1);
        border: 1px solid rgba(245, 158, 11, 0.2);
        color: #fde68a;
        padding: 1rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        text-align: left;
      }

      .lock-notice strong {
        display: block;
        margin-bottom: 0.25rem;
      }

      .lock-notice .name {
        color: white;
        font-weight: 700;
      }

      .result {
        text-align: center;
        padding: 2rem 0;
      }

      .result .label {
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-size: 0.75rem;
        font-weight: 700;
        margin-bottom: 1rem;
      }

      .result .name {
        font-size: 3rem;
        font-weight: 800;
        background: linear-gradient(90deg, #f87171, white, #f87171);
        background-size: 200% auto;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: shimmer 3s linear infinite;
      }

      .result .note {
        margin-top: 2rem;
        font-size: 0.75rem;
        color: #64748b;
        font-style: italic;
      }

      @keyframes shimmer {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }

      .import-section {
        display: none;
      }

      .import-section.show {
        display: block;
      }

      .import-section textarea {
        width: 100%;
        resize: none;
      }

      .import-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .hidden {
        display: none !important;
      }

      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(30, 41, 59, 0.5);
      }

      ::-webkit-scrollbar-thumb {
        background: #475569;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Turbo<span>Santa</span></h1>
      <p>Stateless, client-side, magic.</p>
    </header>

    <main>
      <div id="app-content">
        <div style="text-align: center; color: #94a3b8; padding: 2rem 0;">Loading...</div>
      </div>
    </main>

    <script>
     function mulberry32(a) {
       return function() {
         var t = a += 0x6D2B79F5;
         t = Math.imul(t ^ (t >>> 15), t | 1);
         t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
         return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
       }
     }

     function shuffle(array, rng) {
       let currentIndex = array.length, randomIndex;
       const newArray = [...array];
       while (currentIndex !== 0) {
         randomIndex = Math.floor(rng() * currentIndex);
         currentIndex--;
         [newArray[currentIndex], newArray[randomIndex]] = [
           newArray[randomIndex], newArray[currentIndex]];
       }
       return newArray;
     }

     function getAssignment(userName, allNames, seed) {
       const rng = mulberry32(seed);
       const baseList = [...allNames].sort();
       const listA = shuffle(baseList, rng);
       const listB = shuffle(baseList, rng);

       const indexInA = listA.indexOf(userName);
       if (indexInA === -1) return null;
       return listB[indexInA];
     }

     function isSeedValid(names, seed) {
       for (const name of names) {
         const assigned = getAssignment(name, names, seed);
         if (assigned === name) return false;
       }
       return true;
     }

     const encodeData = (data) => {
       try { return btoa(encodeURIComponent(JSON.stringify(data))); }
       catch (e) { return ""; }
     };

     const decodeData = (str) => {
       try { return JSON.parse(decodeURIComponent(atob(str))); }
       catch (e) { return null; }
     };

     const state = {
       mode: 'loading',
       names: [],
       seed: null,
       generatedLink: '',
       currentUser: '',
       assignment: null,
       isLocked: false,
       reveal: false
     };

     function render() {
       const container = document.getElementById('app-content');
       container.innerHTML = '';

       if (state.mode === 'create') {
         renderCreateMode(container);
       } else if (state.mode === 'view') {
         renderViewMode(container);
       }
     }

     function renderCreateMode(container) {
       const html = `
         <div class="space-y">
           <div class="space-y-sm">
             <h2>Add Participants</h2>
             <form id="add-form" class="form-row">
               <input type="text" id="new-name-input" placeholder="Enter name (e.g. Phil)">
               <button type="submit" id="add-btn" class="btn-primary" disabled>Add</button>
             </form>
             <button id="import-btn" class="link-btn">Import comma-separated list</button>
             <div id="import-section" class="import-section">
               <textarea id="import-input" placeholder="e.g. Phil, Michael, Claire" rows="2"></textarea>
               <div class="import-actions">
                 <button id="import-submit" class="btn-primary">Import</button>
                 <button id="import-cancel" class="link-btn">Cancel</button>
               </div>
             </div>
           </div>

           <div class="space-y-sm">
             <div class="list-header">
               <span>Current List (${state.names.length})</span>
               ${state.names.length > 0 ? '<button id="clear-btn" class="link-btn link-btn-red">Clear All</button>' : ''}
             </div>

             <ul class="name-list">
               ${state.names.length === 0
               ? '<li class="empty">No names added yet.</li>'
               : state.names.map(name => `
                 <li>
                   <span>${name}</span>
                   <button data-remove="${name}" class="remove-btn">&times;</button>
                 </li>
               `).join('')}
             </ul>
           </div>

           ${!state.generatedLink ? `
             <button id="generate-btn" class="btn-green" ${state.names.length < 2 ? 'disabled' : ''}>
               Generate Magic Link
             </button>
           ` : `
             <div class="success-box">
               <div class="header">
                 <div class="icon">âœ“</div>
                 <div>
                   <h3>Link Ready!</h3>
                   <p>Send this URL to everyone. It contains the names and a safe assignment key.</p>
                 </div>
               </div>

               <div class="copy-row">
                 <input type="text" readonly value="${state.generatedLink}">
                 <button id="copy-btn" class="btn-secondary">Copy</button>
               </div>
               <p id="copy-feedback" class="feedback">Copied to clipboard!</p>

               <button id="reset-btn" class="link-btn" style="width: 100%; text-align: center; margin-top: 0.75rem;">
                 Reset and edit list
               </button>
             </div>
           `}
         </div>
       `;
       container.innerHTML = html;
       attachCreateListeners();
     }

     function renderViewMode(container) {
       let html = '';

       if (!state.reveal) {
         html = `
           <div class="space-y view-header">
             <div class="avatar">
               <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                 <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                 <circle cx="12" cy="7" r="4"/>
               </svg>
             </div>

             <div>
               <h2>Who are you?</h2>
               <p>Select your name to see your match.</p>
             </div>

             ${state.isLocked ? `
               <div class="lock-notice">
                 <strong>Browser Locked.</strong>
                 We found a previous session on this device for <span class="name">${state.currentUser}</span>.
               </div>
             ` : `
               <select id="user-select">
                 <option value="">-- Select Your Name --</option>
                 ${state.names.sort().map(n => `<option value="${n}" ${n === state.currentUser ? 'selected' : ''}>${n}</option>`).join('')}
               </select>
             `}

             <button id="reveal-btn" class="btn-primary" style="width: 100%; padding: 0.75rem; font-size: 1.125rem; font-weight: 700; border-radius: 0.75rem;" ${!state.currentUser ? 'disabled' : ''}>
               ${state.isLocked ? "View My Match" : "Reveal My Match"}
             </button>
           </div>
         `;
       } else {
         html = `
           <div class="result">
             <p class="label">You are buying a gift for</p>
             <p class="name">${state.assignment}</p>
             <p class="note">Yes, yes, you could open this page in incognito or another browser and pick someone else. Don't be that guy.</p>
           </div>
         `;
       }

       container.innerHTML = html;
       attachViewListeners();
     }

     function attachCreateListeners() {
       const form = document.getElementById('add-form');
       const input = document.getElementById('new-name-input');
       const addBtn = document.getElementById('add-btn');

       if(input) {
         input.addEventListener('input', (e) => {
           const val = e.target.value.trim();
           addBtn.disabled = !val || state.names.includes(val);
         });
       }

       if(form) {
         form.addEventListener('submit', (e) => {
           e.preventDefault();
           const val = input.value.trim();
           if (val && !state.names.includes(val)) {
             state.names.push(val);
             render();
             setTimeout(() => document.getElementById('new-name-input').focus(), 0);
           }
         });
       }

       document.querySelectorAll('[data-remove]').forEach(btn => {
         btn.addEventListener('click', (e) => {
           const nameToRemove = e.currentTarget.getAttribute('data-remove');
           state.names = state.names.filter(n => n !== nameToRemove);
           render();
         });
       });

       const clearBtn = document.getElementById('clear-btn');
       if (clearBtn) {
         clearBtn.addEventListener('click', () => {
           state.names = [];
           state.generatedLink = '';
           state.seed = null;
           render();
         });
       }

       const genBtn = document.getElementById('generate-btn');
       if (genBtn) {
         genBtn.addEventListener('click', () => {
           let validSeed = null;
           let attempts = 0;
           while (validSeed === null && attempts < 1000) {
             const testSeed = Math.floor(Math.random() * 1000000);
             if (isSeedValid(state.names, testSeed)) {
               validSeed = testSeed;
             }
             attempts++;
           }

           if (!validSeed) {
             alert("Could not generate a valid arrangement. Try adding more names.");
             return;
           }

           const dataString = encodeData(state.names);
           state.generatedLink = `${window.location.origin}${window.location.pathname}?d=${dataString}&s=${validSeed}`;
           state.seed = validSeed;
           render();
         });
       }

       const copyBtn = document.getElementById('copy-btn');
       if (copyBtn) {
         copyBtn.addEventListener('click', () => {
           navigator.clipboard.writeText(state.generatedLink);
           const feedback = document.getElementById('copy-feedback');
           feedback.classList.add('show');
           setTimeout(() => feedback.classList.remove('show'), 2000);
         });
       }

       const resetBtn = document.getElementById('reset-btn');
       if (resetBtn) {
         resetBtn.addEventListener('click', () => {
           state.generatedLink = '';
           state.seed = null;
           render();
         });
       }

       const importBtn = document.getElementById('import-btn');
       const importSection = document.getElementById('import-section');
       if (importBtn && importSection) {
         importBtn.addEventListener('click', () => {
           importSection.classList.add('show');
           importBtn.classList.add('hidden');
         });
       }

       const importCancel = document.getElementById('import-cancel');
       if (importCancel) {
         importCancel.addEventListener('click', () => {
           importSection.classList.remove('show');
           importBtn.classList.remove('hidden');
           document.getElementById('import-input').value = '';
         });
       }

       const importSubmit = document.getElementById('import-submit');
       if (importSubmit) {
         importSubmit.addEventListener('click', () => {
           const input = document.getElementById('import-input').value;
           const names = input.split(',')
                              .map(n => n.trim())
                              .filter(n => n && !state.names.includes(n));
           state.names.push(...names);
           render();
         });
       }
     }

     function attachViewListeners() {
       const select = document.getElementById('user-select');
       const revealBtn = document.getElementById('reveal-btn');

       if (select) {
         select.addEventListener('change', (e) => {
           state.currentUser = e.target.value;
           render();
         });
       }

       if (revealBtn) {
         revealBtn.addEventListener('click', () => {
           const target = getAssignment(state.currentUser, state.names, state.seed);
           state.assignment = target;
           state.reveal = true;
           state.isLocked = true;

           const storageKey = `santa_lock_${state.seed}`;
           localStorage.setItem(storageKey, state.currentUser);

           render();
         });
       }
     }

     function init() {
       const params = new URLSearchParams(window.location.search);
       const dataParam = params.get('d');
       const seedParam = params.get('s');

       if (dataParam && seedParam) {
         const decodedNames = decodeData(dataParam);
         const parsedSeed = parseInt(seedParam, 10);

         if (decodedNames && !isNaN(parsedSeed)) {
           state.names = decodedNames;
           state.seed = parsedSeed;
           state.mode = 'view';

           const storageKey = `santa_lock_${parsedSeed}`;
           const storedUser = localStorage.getItem(storageKey);

           if (storedUser && decodedNames.includes(storedUser)) {
             state.currentUser = storedUser;
             state.isLocked = true;
             state.assignment = getAssignment(storedUser, decodedNames, parsedSeed);
             state.reveal = true;
           }
         } else {
           state.mode = 'create';
         }
       } else {
         state.mode = 'create';
       }

       render();
     }

     init();

    </script>
  </body>
</html>
